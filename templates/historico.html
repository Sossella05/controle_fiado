{% extends "base.html" %}
{% block content %}
<h3 class="fw-semibold mb-4">üìú Hist√≥rico de {{ cliente }}</h3>

<!-- Bot√£o PDF -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <a href="/" class="btn btn-secondary">‚¨ÖÔ∏è Voltar</a>
  <a href="/baixar/{{ cliente_id }}" class="btn btn-outline-primary">‚¨áÔ∏è Baixar hist√≥rico (PDF)</a>
</div>

<!-- Pesquisa -->
<div class="input-group mb-4">
  <span class="input-group-text bg-white border-end-0">üîç</span>
  <input type="text" id="pesquisaHistorico" class="form-control border-start-0 search-input"
         placeholder="Buscar por data ou valor...">
</div>

<!-- Tabela -->
<div class="card p-3 shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle text-center">
      <thead>
        <tr>
          <th>Data</th>
          <th>Valor da Compra</th>
          <th>Valor Pago</th>
        </tr>
      </thead>
      <tbody>
        {% for id, data, valor_compra, valor_pago in vendas %}
        <tr>
          <td>{{ data }}</td>
          <td>R$ {{ "%.2f"|format(valor_compra) }}</td>
          <td>R$ {{ "%.2f"|format(valor_pago) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card p-3 mt-3 bg-light border-0">
    <p><strong>Total Compras:</strong> R$ {{ "%.2f"|format(total_compra) }}</p>
    <p><strong>Total Pago:</strong> R$ {{ "%.2f"|format(total_pago) }}</p>
    <p><strong>Saldo Devedor:</strong>
      <span class="{{ 'text-danger fw-semibold' if saldo > 0 else 'text-success fw-semibold' }}">
        R$ {{ "%.2f"|format(saldo) }}
      </span>
    </p>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.getElementById("pesquisaHistorico").addEventListener("keyup", function() {
    const termo = this.value.toLowerCase();
    const linhas = document.querySelectorAll("tbody tr");
    linhas.forEach(l => {
      l.style.display = l.innerText.toLowerCase().includes(termo) ? "" : "none";
    });
  });
</script>
{% endblock %}
